@using Microsoft.AspNetCore.Mvc.RazorPages
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>@ViewData["Title"] - Pharmix.Web</title>

    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 4.1.1 -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/lib/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="~/lib/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/assets-themes/css/AdminLTE.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="~/assets-themes/css/skins/skin-black-light.min.css">
    <link href="~/scheduler/css/escScheduler.css" rel="stylesheet" />
    <link href="~/css/plugins/jquery-spin/jquery-loading.css" rel="stylesheet" />
    @*<link href="~/css/plugins/chosen/chosen.css" rel="stylesheet" />*@
    <link href="~/css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet" />
    <link href="~/lib/toastr/toastr.min.css" rel="stylesheet" />
    <link href="~/css/site.css" rel="stylesheet" />
    <!-- Custom Css will rendered here -->
    @RenderSection("Styles", required: false)

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

    <!-- jQuery 3 -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- SlimScroll -->

    <script src="~/lib/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="~/lib/fastclick/lib/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="~/assets-themes/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/scheduler/js/escScheduler.js"></script>
    <script src="~/scheduler/js/jquery.mousewheel.min.js"></script>
    <script src="~/lib/plugins/jquery-spin/jquery-loading.js"></script>
    <script src="~/lib/plugins/chosen/chosen.jquery.js"></script>
    <script src="~/lib/toastr/toastr.min.js"></script>
    <script src="~/js/bootstrap-dialog.min.js"></script>
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>

    <script src="~/js/framework-utility.js"></script>
    <script src="~/js/framework-popup.js"></script>
    <script src="~/js/framework-spinner.js"></script>

</head>
<body class="sidebar-mini skin-black-light fixed">
    <!-- Site wrapper -->
<div class="wrapper">
<header class="main-header">
    <!-- Logo -->
    <a href="/" class="logo">
        <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini">
            <img src="~/assets-themes/img/m-logo.png" class="img-responsive" alt="Pharmix Technologies Ltd">
        </span>
        <!-- logo for regular state and mobile devices -->
        <span class="logo-lg"><img src="~/assets-themes/img/b-logo.png" class="img-responsive" alt="Pharmix Technologies Ltd"></span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
        <!-- Sidebar toggle button-->
        <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>
        <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
                @if (User.Identity.IsAuthenticated)
                {
                    <!-- Notifications: style can be found in dropdown.less -->
                    <li class="dropdown notifications-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="label label-warning"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have 0 notifications</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu">
                                    
                                </ul>
                            </li>
                            <li class="footer"><a href="#"></a></li>
                        </ul>
                    </li>
                    <!-- Messages: style can be found in dropdown.less-->
                    <li class="dropdown messages-menu" title="Your messages">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-envelope-o"></i>
                            <span class="label label-success"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have 0 messages</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu">
                                </ul>
                            </li>
                            <li class="footer"><a href="#">See All Messages</a></li>
                        </ul>
                    </li>
                    <!-- Tasks: style can be found in dropdown.less -->
                    <li class="dropdown tasks-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-flag-o"></i>
                            <span class="label label-danger"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have 0 tasks</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu">
                                </ul>
                            </li>
                            <li class="footer">
                                <a href="#"></a>
                            </li>
                        </ul>
                    </li>
                    <!-- User Account: style can be found in dropdown.less -->
                    <li class="dropdown user user-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <img src="~/assets-themes/img/user2-160x160.jpg" class="user-image" alt="User Image">
                            <span class="hidden-xs">@User.Identity.Name</span>
                        </a>
                        <ul class="dropdown-menu">
                            <!-- User image -->
                            <li class="user-header">
                                <img src="~/assets-themes/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                <p>
                                    @User.Identity.Name
                                    <small></small>
                                </p>
                            </li>
                            <!-- Menu Body -->
                            <li class="user-body">
                                <div class="row">
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Followers</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Sales</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Friends</a>
                                    </div>
                                </div>
                                <!-- /.row -->
                            </li>
                            <!-- Menu Footer-->
                            <li class="user-footer">
                                <div class="pull-left">
                                    <a href="#" class="btn btn-default btn-flat">Profile</a>
                                </div>
                                <div class="pull-right">
                                    <form asp-area="" asp-controller="Account" asp-action="Logout" method="post" id="logoutForm">
                                        <button type="submit" class="btn btn-default btn-flat">Log out</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <!-- Control Sidebar Toggle Button -->
                    <li>
                        <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                    </li>
                }
                else
                {
                    <li>
                        <a class="btn" asp-action="Login" asp-controller="Account"><i class="fa fa-sign-in"></i>&nbsp;Login</a>
                    </li>
                    <li>
                        <a class="btn" asp-action="Register" asp-controller="Account"><i class="fa fa-check"></i>&nbsp;Register</a>
                    </li>
                }
            </ul>
        </div>
    </nav>
</header>
<!-- =============================================== -->
<!-- Left side column. contains the sidebar -->
<aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
        <!-- Sidebar user panel -->
        @if (User.Identity.IsAuthenticated)
        {
            <div class="user-panel">
                <div class="pull-left image">
                    <img src="~/assets-themes/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p>@User.Identity.Name</p>
                    <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                </div>
            </div>
        }
        <!-- search form -->
        <form action="#" method="get" class="sidebar-form">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search...">
                <span class="input-group-btn">
                    <button type="submit" name="search" id="search-btn" class="btn btn-flat">
                        <i class="fa fa-search"></i>
                    </button>
                </span>
            </div>
        </form>


        <ul class="sidebar-menu" data-widget="tree">
            <li class="header">MAIN NAVIGATION</li>
            @if (User.Identity.IsAuthenticated)
    {
        <li><a asp-controller="Patient" asp-action="Detail" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Patient Info</span></a></li>
        <li><a asp-controller="Patient" asp-action="CommunicationNeed" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Communication Need</span></a></li>
        <li><a asp-controller="Patient" asp-action="PlanOfCare" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Plan Of Care</span></a></li>
        <li><a asp-controller="Patient" asp-action="MaternityContact" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Maternity Contact</span></a></li>
        <li><a asp-controller="Patient" asp-action="PrimaryCareContact" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Primary Care Contact</span></a></li>
        <li><a asp-controller="Patient" asp-action="NextOfKin" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Next of Kin</span></a></li>
        <li><a asp-controller="Patient" asp-action="EmergencyContact" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Emergency Contact</span></a></li>
        <li><a asp-controller="Patient" asp-action="YourDetail" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Your Detail</span></a></li>
        <li><a asp-controller="Patient" asp-action="PartnerDetail" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Partner Detail</span></a></li>

        <li><a asp-controller="Patient" asp-action="MedicalHistory" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Medical History</span></a></li>
        <li><a asp-controller="Patient" asp-action="MentalHealth" asp-route-PatientId="@ViewData["PatientId"]"><i class="fa fa-dashboard"></i> <span>Mental Health</span></a></li>
}
        </ul>
    </section>
    <!-- /.sidebar -->
</aside>
<!-- =============================================== -->
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <div class="container-fluid">
        @RenderBody()
    </div>
    <div id="fw-spinner" class="fw-spinner" style="display: none">
        <div class="fw-spinnerOverlay"></div>
    </div>
</div>
<!-- /.content-wrapper -->
<footer class="main-footer">
    <div class="pull-right hidden-xs">
        <b>Version</b> 2.4.0
    </div>
    <strong>Copyright &copy; 2017-@DateTime.Now.Year <a href="http://pharmix.co.uk">Pharmix Technologies Ltd</a>.</strong> All rights reserved.
</footer>
<!-- Control Sidebar -->
<!-- /.control-sidebar -->
<!-- Add the sidebar's background. This div must be placed
immediately after the control sidebar -->
<div class="control-sidebar-bg"></div>
</div>
<input type="hidden" id="hdnIsSupervisorPage" value="@(User.IsInRole("IsoSupervisor")?"True":"False")" />
    <!-- ./wrapper -->
@*<script src="../../dist/js/demo.js"></script>*@
    
    <script>
        $(document).ready(function () {
            $('.sidebar-menu').tree();
        
            var connection = new signalR.HubConnection("/productionhub");
            connection.start().then(function () {
                console.log("connection start");
            });

            var addUserNotification = function(msg) {
                var $notify = $(".notifications-menu:eq(0)");

                var $badge = $notify.find(".dropdown-toggle .label-warning:eq(0)");
                $badge.text($badge.text().length > 0 ? (parseInt($badge.text()) + 1) : 1);

                var $header = $notify.find(".dropdown-menu .header:eq(0)");
                $header.html("You have " + $badge.text() + " notifications");

                var $menu = $notify.find(".dropdown-menu .menu:eq(0)");
                $menu.append("<li><a href='@Url.Action("SupervisorRequestTracking", "Production")'><i class='fa fa-bell text-info'></i>&nbsp;" + msg +"</a></li>");
            }

            connection.on('UserNotification', function (message) {
                console.log("Noification : " + message);
                $("#linkSearch").trigger("click");
                toastr.info(message);
                addUserNotification(message);
            });

            connection.on('SupervisorNotification', function (message) {
                console.log("reloaded");
                $("#linkSearch").trigger("click");
                if ($("#hdnIsSupervisorPage").val() == "True") {
                    toastr.info(message);
                    addUserNotification(message);
                }
            });
        })
    </script>
    @RenderSection("scripts", required: false)
</body>
</html>
